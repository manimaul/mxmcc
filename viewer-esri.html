<!DOCTYPE html>
<html>
<head>
    <title>Esri Viewer</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <link rel="stylesheet" href="http://js.arcgis.com/3.8/js/esri/css/esri.css">
    <script src="http://js.arcgis.com/3.8/"></script>
</head>
<body>
<div id="map">
    <script src="viewer.js"></script>
    <script>
        var metadata = read_metadata();
        var map;
        require(['esri/map', 'esri/geometry/Extent', 'esri/layers/WebTiledLayer'],

                function (Map, Extent, WebTiledLayer) {
                    var mapBounds = new esri.geometry.Extent({
                        xmin: metadata.bounds[0], ymin: metadata.bounds[1],
                        xmax: metadata.bounds[2], ymax: metadata.bounds[3],
                        spatialReference: {wkid: 4326}
                    });
                    var mapMinZoom = metadata.minzoom;
                    var mapMaxZoom = metadata.maxzoom;
                    var loc = window.location.pathname;
                    var dir = loc.substring(0, loc.lastIndexOf('/'));
                    var tiles = window.location.protocol + '//' + window.location.host + '/' + dir + '/{z}/{x}/{y}.png';
                    console.log('tiles', tiles);
                    map = new Map('map', {
                        basemap: 'national-geographic', // streets | satellite | hybrid | topo | gray | oceans | national-geographic | osm
                        smartNavigation: false,
                        extent: mapBounds,
                        fitExtent: true
                    });
                    var maptiler = new WebTiledLayer(tiles.replace('{z}/{x}/{y}', '${level}/${col}/${row}'), {
                        copyright: metadata.attribution,
                        id: metadata.name
                    });
                    map.addLayer(maptiler);
                });
    </script>
</body>
</html>